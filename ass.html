<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>e621 API Example</title>
<script>
// Function to make API requests
async function apiRequest(endpoint, params = {}) {
  const username = "xIcee0";
  const apiKey = "jbUR2JD9D6QMSa3rGHiSMru3";
  const authHeader = "Basic " + btoa(`${username}:${apiKey}`);
  const url = new URL(`https://e621.net/${endpoint}`);
  url.search = new URLSearchParams(params).toString();

  const response = await fetch(url, {
    method: 'GET',
    headers: { 'Authorization': authHeader }
  });

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  return response.json();
}

// Function to get similar tags
async function getSimilarTags() {
  try {
    // Get favorited posts
    const favoritedData = await apiRequest('favorites.json', { 'user_id': 'xIcee0', 'limit': 15 });
    const favorites = favoritedData.posts;
    const excludedIds = favorites.map(post => post.id);
    let allTags = [];

    // Collect all tags from the favorites
    favorites.forEach(post => {
      allTags.push(...post.tags.general);
    });

    // Find unique tags
    const uniqueTags = Array.from(new Set(allTags));
    
    // Get posts with similar tags, excluding favorites
    const similarPostsPromise = uniqueTags.map(tag =>
      apiRequest('posts.json', { 'tags': tag, 'limit': 1 })
    );

    const similarPostsData = await Promise.all(similarPostsPromise);
    const similarTags = similarPostsData.map(data =>
      data.posts.map(post =>
        post.tags.general.filter(tag => !uniqueTags.includes(tag))
      ).flat()
    );

    // Flatten the array of tags and filter out duplicates
    const similarUniqueTags = Array.from(new Set(similarTags.flat()));
    
    // Display the similar tags on the page
    const tagsList = document.getElementById('similar-tags');
    similarUniqueTags.forEach(tag => {
      const listItem = document.createElement('li');
      listItem.textContent = tag;
      tagsList.appendChild(listItem);
    });
  } catch (error) {
    console.error('Error fetching similar tags:', error);
  }
}

// Call the function after the page has loaded
window.addEventListener('load', getSimilarTags);
</script>
</head>
<body>
<h1>Similar Tags from e621 API</h1>
<ul id="similar-tags">
  <!-- Similar tags will be listed here -->
</ul>
</body>
</html>